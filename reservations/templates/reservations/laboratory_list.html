{% extends 'reservations/base.html' %}

{% block title %}å®éªŒå®¤åˆ—è¡¨ - å®éªŒå®¤é¢„çº¦ç³»ç»Ÿ{% endblock %}

{% block content %}

<section class="hero-banner">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8 hero-content fade-in">
                <h1 class="hero-title">
                   æ±Ÿç§‘å¤§å®éªŒå®¤é¢„çº¦ç³»ç»Ÿ 
                </h1>
                <p class="hero-subtitle">
                    æ±Ÿè‹ç§‘æŠ€å¤§å­¦å¼ å®¶æ¸¯æ ¡åŒºå®éªŒå®¤é¢„çº¦ç³»ç»Ÿï¼Œä¸ºå­¦ç”Ÿç¾¤ä½“æä¾›ä¾¿æ·æœåŠ¡
                </p>
                <div class="hero-buttons">
                    {% if user.is_authenticated %}
                        <a href="#laboratories" class="btn btn-light btn-lg">
                            <i class="fas fa-search me-2"></i>æµè§ˆå®éªŒå®¤
                        </a>
                        <a href="{% url 'reservations:my_reservations' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-calendar-check me-2"></i>æˆ‘çš„é¢„çº¦
                        </a>
                    {% else %}
                        <a href="{% url 'reservations:login' %}" class="btn btn-light btn-lg">
                            <i class="fas fa-sign-in-alt me-2"></i>ç«‹å³ç™»å½•
                        </a>
                        <a href="{% url 'reservations:register' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-user-plus me-2"></i>æ³¨å†Œè´¦æˆ·
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- æœç´¢åŒºåŸŸ -->
<section class="search-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <form method="get" class="d-flex gap-3 mb-4" id="searchForm">
                    <input type="text" name="search" class="form-control search-box flex-grow-1"
                           placeholder="ğŸ” æœç´¢å®éªŒå®¤åç§°ã€ä½ç½®æˆ–è®¾å¤‡..." value="{{ search_query }}">
                    <input type="hidden" name="category" value="{{ category_filter }}">
                    <button type="submit" class="btn search-btn">
                        <i class="fas fa-search me-2"></i>æœç´¢
                    </button>
                </form>

                <!-- åˆ†ç±»ç­›é€‰å™¨ -->
                <div class="category-filter mb-4">
                    <h6 class="mb-3"><i class="fas fa-filter me-2"></i>æŒ‰ç§‘ç›®ç­›é€‰</h6>
                    <div class="category-buttons d-flex flex-wrap gap-2">
                        <button class="btn category-btn {% if not category_filter %}active{% endif %}"
                                data-category="">
                            <i class="fas fa-th-large me-1"></i>å…¨éƒ¨ ({{ total_count }})
                        </button>
                        {% for category_code, category_info in category_counts.items %}
                            <button class="btn category-btn {% if category_filter == category_code %}active{% endif %}"
                                    data-category="{{ category_code }}">
                                <i class="fas fa-circle me-1" style="color: {{ category_info.color }}"></i>
                                {{ category_info.name }} ({{ category_info.count }})
                            </button>
                        {% endfor %}
                    </div>
                </div>

                {% if search_query or category_filter %}
                    <div class="text-center">
                        <span class="text-muted">
                            {% if search_query and category_filter %}
                                æœç´¢ "{{ search_query }}" åœ¨ "{{ category_filter }}" åˆ†ç±»ä¸­çš„ç»“æœï¼Œå…±æ‰¾åˆ° {{ laboratories.count }} ä¸ªå®éªŒå®¤
                            {% elif search_query %}
                                æœç´¢ "{{ search_query }}" çš„ç»“æœï¼Œå…±æ‰¾åˆ° {{ laboratories.count }} ä¸ªå®éªŒå®¤
                            {% elif category_filter %}
                                "{{ category_filter }}" åˆ†ç±»çš„å®éªŒå®¤ï¼Œå…± {{ laboratories.count }} ä¸ª
                            {% endif %}
                        </span>
                        <a href="{% url 'reservations:laboratory_list' %}" class="btn btn-sm btn-outline-secondary ms-2">
                            <i class="fas fa-times me-1"></i>æ¸…é™¤ç­›é€‰
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- å®éªŒå®¤åˆ—è¡¨ -->
<section id="laboratories" class="py-5">
    <div class="container">
        {% if laboratories %}
            <div class="row g-4">
                {% for lab in laboratories %}
                    <div class="col-lg-4 col-md-6">
                        <div class="lab-card fade-in">
                            <!-- å¡ç‰‡å¤´éƒ¨ -->
                            <div class="lab-card-header">
                                <div class="lab-icon" style="background: linear-gradient(135deg, {{ lab.get_category_color }}, {{ lab.get_category_color }}dd);">
                                    <i class="{{ lab.get_category_icon }}"></i>
                                </div>
                                <h3 class="lab-card-title">{{ lab.name }}</h3>
                                <p class="lab-card-location">
                                    <i class="fas fa-map-marker-alt me-1"></i>{{ lab.location }}
                                </p>
                                <span class="category-badge" style="background-color: {{ lab.get_category_color }};">
                                    {{ lab.get_category_display }}
                                </span>
                            </div>

                            <!-- å¡ç‰‡å†…å®¹ -->
                            <div class="lab-card-body">
                                <div class="lab-info-item">
                                    <i class="fas fa-users"></i>
                                    <span><strong>å®¹é‡ï¼š</strong>{{ lab.capacity }} äºº</span>
                                </div>

                                {% if lab.description %}
                                    <div class="lab-info-item">
                                        <i class="fas fa-info-circle"></i>
                                        <span>{{ lab.description|truncatewords:12 }}</span>
                                    </div>
                                {% endif %}

                                {% if lab.equipment %}
                                    <div class="lab-info-item">
                                        <i class="fas fa-tools"></i>
                                        <span>{{ lab.equipment|truncatewords:8 }}</span>
                                    </div>
                                {% endif %}

                                <div class="lab-info-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span class="badge bg-success">å¯é¢„çº¦</span>
                                </div>
                            </div>

                            <!-- å¡ç‰‡åº•éƒ¨ -->
                            <div class="lab-card-footer">
                                <div class="d-grid gap-2">
                                    {% if user.is_authenticated %}
                                        <a href="{% url 'reservations:make_reservation' lab.id %}"
                                           class="btn btn-primary btn-modern">
                                            <i class="fas fa-calendar-plus me-2"></i>ç«‹å³é¢„çº¦
                                        </a>
                                        <a href="{% url 'reservations:laboratory_detail' lab.id %}"
                                           class="btn btn-outline-secondary btn-modern">
                                            <i class="fas fa-eye me-2"></i>æŸ¥çœ‹è¯¦æƒ…
                                        </a>
                                    {% else %}
                                        <a href="{% url 'reservations:login' %}?next={% url 'reservations:make_reservation' lab.id %}"
                                           class="btn btn-primary btn-modern">
                                            <i class="fas fa-sign-in-alt me-2"></i>ç™»å½•é¢„çº¦
                                        </a>
                                        <a href="{% url 'reservations:laboratory_detail' lab.id %}"
                                           class="btn btn-outline-secondary btn-modern">
                                            <i class="fas fa-eye me-2"></i>æŸ¥çœ‹è¯¦æƒ…
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- ç©ºçŠ¶æ€ -->
            <div class="text-center py-5">
                <div class="mb-4">
                    <i class="fas fa-search fa-4x text-muted mb-3"></i>
                    <h3 class="text-muted">æ²¡æœ‰æ‰¾åˆ°å®éªŒå®¤</h3>
                    {% if search_query %}
                        <p class="text-muted mb-4">è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯æˆ–æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å®éªŒå®¤</p>
                        <a href="{% url 'reservations:laboratory_list' %}" class="btn btn-primary btn-modern">
                            <i class="fas fa-list me-2"></i>æŸ¥çœ‹æ‰€æœ‰å®éªŒå®¤
                        </a>
                    {% else %}
                        <p class="text-muted mb-4">æš‚æ—¶æ²¡æœ‰å¯ç”¨çš„å®éªŒå®¤ï¼Œè¯·ç¨åå†è¯•</p>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- åŠŸèƒ½ä»‹ç»åŒºåŸŸ -->
{% if not user.is_authenticated %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="mb-4">
                    <i class="fas fa-info-circle me-2 text-primary"></i>å¼€å§‹ä½¿ç”¨å®éªŒå®¤é¢„çº¦ç³»ç»Ÿ
                </h2>
                <p class="lead text-muted mb-4">
                    æ³¨å†Œè´¦æˆ·åå³å¯äº«å—ä¾¿æ·çš„å®éªŒå®¤é¢„çº¦æœåŠ¡ï¼Œæ”¯æŒåœ¨çº¿ç”³è¯·ã€çŠ¶æ€æŸ¥è¯¢å’Œé¢„çº¦ç®¡ç†
                </p>
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="lab-icon mx-auto mb-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-search"></i>
                            </div>
                            <h5>æµè§ˆå®éªŒå®¤</h5>
                            <p class="text-muted small">æŸ¥çœ‹è¯¦ç»†çš„å®éªŒå®¤ä¿¡æ¯å’Œè®¾å¤‡é…ç½®</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="lab-icon mx-auto mb-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-calendar-plus"></i>
                            </div>
                            <h5>åœ¨çº¿é¢„çº¦</h5>
                            <p class="text-muted small">é€‰æ‹©åˆé€‚çš„æ—¶é—´æ®µæäº¤é¢„çº¦ç”³è¯·</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="lab-icon mx-auto mb-3" style="width: 60px; height: 60px;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h5>çŠ¶æ€è·Ÿè¸ª</h5>
                            <p class="text-muted small">å®æ—¶æŸ¥çœ‹é¢„çº¦çŠ¶æ€å’Œå®¡æ ¸ç»“æœ</p>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center gap-3">
                    <a href="{% url 'reservations:login' %}" class="btn btn-primary btn-lg btn-modern">
                        <i class="fas fa-sign-in-alt me-2"></i>ç«‹å³ç™»å½•
                    </a>
                    <a href="{% url 'reservations:register' %}" class="btn btn-outline-primary btn-lg btn-modern">
                        <i class="fas fa-user-plus me-2"></i>æ³¨å†Œè´¦æˆ·
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}
